// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};e=jQuery;f=localStorage;u=0;l=function(){DEBUG&&console.log("\n#"+u);u%UPDATE_CANTINAS_INTERVAL===0&&f.showCantina==="true"&&p();u%UPDATE_BUS_INTERVAL===0&&f.showBus==="true"&&h();u%UPDATE_NEWS_INTERVAL===0&&d();1e4<u?u=0:u++;return setTimeout(function(){return l()},PAGE_LOOP)};p=function(){var t,r,i,s;DEBUG&&console.log("updateCantinas");t="http://sit.no/rss.ap?thisId=36444&ma=on&ti=on&on=on&to=on&fr=on";i="http://sit.no/rss.ap?thisId=36447&ma=on&ti=on&on=on&to=on&fr=on";r="http://sit.no/content/36444/Ukas-middagsmeny-pa-Hangaren";s="http://sit.no/content/36447/Ukas-middagsmeny-pa-Realfag";Cantina.get(t,function(t){e("#cantinas #hangaren #dinnerbox").html(a(t,r));return n("#cantinas #hangaren #dinnerbox .dinnerlist",r)});return Cantina.get(i,function(t){e("#cantinas #realfag #dinnerbox").html(a(t,s));return n("#cantinas #realfag #dinnerbox .dinnerlist",s)})};a=function(e,t){var n,r,i,s,o;r="";if(typeof e=="string"){f.noDinnerInfo="true";r+='<li class="dinnerlist">'+e+"</li>"}else{f.noDinnerInfo="false";for(s=0,o=e.length;s<o;s++){n=e[s];n.price!==null?i=n.price+",- ":i="";r+='<li class="dinnerlist" id="'+n.index+'">'+i+n.text+"</li>"}}return r};n=function(t,n){return e(t).click(function(){var t;t=e(this).attr("id");f.chosenDinner=t;chrome.tabs.create({url:n});return window.close()})};h=function(){var t,n,r;DEBUG&&console.log("updateBus");if(!navigator.onLine){e("#bus #left .name").html(f.first_bus_name);e("#bus #right .name").html(f.second_bus_name);e("#bus #left .first .line").html("Frakoblet");return e("#bus #right .first .line").html("Frakoblet")}n=f.first_bus_name;r=f.second_bus_name;t=3;Bus.getAnyLines(f.first_bus,t,function(e){return o(e,n,"#left")});return Bus.getAnyLines(f.second_bus,t,function(e){return o(e,r,"#right")})};o=function(t,n,r){var i,s,o,u;if(typeof t=="string"){e("#bus "+r+" .name").html(n);return e("#bus "+r+" .first .line").html(t)}e("#bus "+r+" .name").html(n);o=[".first",".second",".third"];i=0;if(t.departures.length===0)return e("#bus "+r+" "+o[i]+" .line").html("<i>....zzzZZZzzz....</i>");u=[];for(s in t.departures){e("#bus "+r+" "+o[i]+" .line").html(t.destination[s]+" ");e("#bus "+r+" "+o[i]+" .time").html(t.departures[s]);u.push(i++)}return u};d=function(){var t;DEBUG&&console.log("updateNews");t=f.lastResponseData;return t!==void 0?r(t):e("#news").append('<div class="post"><div class="title">No news</div><div class="item">Klarte ikke hente nyheter fra online.ntnu.no</div></div>')};r=function(t){var n,r,i,o,u,a,l,c,h,p,d;l=e.parseXML(t);n=e(l);o=n.find("item");c=e(o[0]).find("guid");d=e(c).text();h=d.split("/")[4];f.mostRecentRead=h;e("#news").html("");u=s();r=[];o.each(function(t,n){var i,s,o;if(t<4){s=parsePost(n);r.push(s.id);i='<div class="post"><div class="title">';t<f.unreadCount&&((o=s.id,v.call(u.indexOf,o)>=0)?i+='<span class="unread">UPDATED <b>::</b> </span>':i+='<span class="unread">NEW <b>::</b> </span>');i+=s.title+'</div>          <div class="item" id="'+s.link+'">            <img id="'+s.id+'" src="'+s.image+'" width="107" />            <div class="textwrapper">              <div class="emphasized">- Av '+s.creator+", skrevet "+s.date+"</div>              "+s.description+"            </div>          </div>        </div>";return e("#news").append(i)}});f.lastViewedIdList=JSON.stringify(r);chrome.browserAction.setBadgeText({text:""});f.unreadCount=0;e(".item").click(function(){chrome.tabs.create({url:e(this).attr("id")});return window.close()});p=[];for(i in r){a=r[i];p.push(getImageUrlForId(a,function(t,n){return e("img[id="+t+"]").attr("src",n)}))}return p};s=function(){var e,t,n,r,i,s,o,u,a;if(f.lastViewedIdList===void 0){f.lastViewedIdList=JSON.stringify([]);return[]}if(f.mostRecentIdList===void 0){f.mostRecentIdList=JSON.stringify([]);return[]}i=JSON.parse(f.lastViewedIdList);t=JSON.parse(f.mostRecentIdList);n=[];for(s=0,u=i.length;s<u;s++){r=i[s];for(o=0,a=t.length;o<a;o++){e=t[o];i[r]===t[e]&&n.push(i[r])}}return n};c=function(e){return i(e,"Innstillinger")};t=function(e){return i(e,"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Bli med i samtalen")};i=function(t,n){var r,i;r=150;i=50;if(t){e("#buttontext").html(n);return e("#buttontext").fadeIn(r)}e("#buttontext").fadeOut(i);return e("#buttontext").html("")};e(function(){if(f.useInfoscreen==="true"){chrome.tabs.create({url:"infoscreen.html"});setTimeout(function(){return window.close()},250)}f.showCantina!=="true"&&e("#cantinas").hide();f.showBus!=="true"&&e("#bus").hide();e("#logo").click(function(){chrome.tabs.create({url:EXTENSION_WEBSITE});return window.close()});e("#options_button").click(function(){chrome.tabs.create({url:"options.html"});return window.close()});e("#chatter_button").click(function(){chrome.tabs.create({url:"http://webchat.freenode.net/?channels=online"});return window.close()});e("#options_button").mouseenter(function(){return c(!0)});e("#options_button").mouseleave(function(){return c(!1)});e("#chatter_button").mouseenter(function(){return t(!0)});e("#chatter_button").mouseleave(function(){return t(!1)});e("#bus #middle img").click(function(){chrome.tabs.create({url:"http://www.atb.no"});return window.close()});return l()})}).call(this);