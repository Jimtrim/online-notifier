// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};e=jQuery;u=localStorage;f=function(){return 1550<e(window).width()?e("#background").attr("style","background:url('img/background-large.png') center center no-repeat;"):1200<e(window).height()?e("#background").attr("style","background:url('img/background-large-vertical.png') center center no-repeat;"):e("#background").attr("style","background:url('img/background-medium.png') center center no-repeat;")};r=function(){e("#notification").fadeIn(200);return setTimeout(function(){return e("#notification").fadeOut(200)},800)};a=function(){return e(".pageflipcursor").animate({opacity:0},"fast","swing",function(){return e(this).animate({opacity:1},"fast","swing")})};d=function(){return Office.get(function(t,n,r){chrome.browserAction.setIcon({path:"img/icon-"+t+".png"});u.currentStatus=t;return Office.getTodaysEvents(function(t){var i;t=e.trim(t);i="### Nå\n"+n+": "+r+"\n\n### Resten av dagen\n"+t;chrome.browserAction.setTitle({title:i});return u.currentStatusMessage=r})})};h=function(){var e;e=webkitNotifications.createHTMLNotification("notification.html");return e.show()};t=function(t){var r,i,a,f;r="#"+t;DEBUG&&console.log("Binding bus fields for "+r);a=50;f=e(r+" input");i=e(r+" select");o(t);e(f).focus(function(){DEBUG&&console.log("focus - clear field and show saved value as placeholder");u.busStopClickedAway=u[t+"_name"];e(f).val("");return e(f).attr("placeholder",u.busStopClickedAway)});e(f).focusout(function(){var n,r,i;r=e(f).val();i=Bus.getPotentialStops(r);if(r===""||i.length===0){DEBUG&&console.log("focusout - empty field or invalid input, return to last saved value");u.busStopClickedAway!==null&&e(f).val(u.busStopClickedAway);return e("#bus_suggestions").html("")}if(i.length===1){DEBUG&&console.log("focusout - 1 suggestion, save it");n=i[0];e(f).val(n);e("#bus_suggestions").html("");return s(t,n)}if(i.length>1){DEBUG&&console.log("focusout - several suggestions, remove them");return setTimeout(function(){return e("#bus_suggestions .suggestion").fadeOut(function(){return e("#bus_suggestions").html("")})},5e3)}if(DEBUG)return console.log("focusout - nothing to do")});e(f).keyup(function(r){var i,o,l,c,h,p,d,m,g,y;if((m=r.keyCode,v.call([37,38,39,40],m)>=0)||(g=r.keyCode,v.call([17,18],g)>=0)||r.keyCode===91){if(DEBUG)return console.log("keyup - arrow key or function key, do nothing")}else{if(r.keyCode!==13){DEBUG&&console.log("keyup - getting suggestions");u.busInFocus=e(f).parent().attr("id");l=e(f).val();if(l.length>0){d=Bus.getPotentialStops(l);e("#bus_suggestions").html("");for(o in d){y=d[o];p=e('<div class="suggestion">'+y+"</div>").hide();e("#bus_suggestions").append(p);e(p).fadeIn()}if(d.length===1){i=d[0];e(f).val(i);e(f).blur();e("#bus_suggestions").html("");p=e('<div class="correct">'+i+"</div>").hide();e("#bus_suggestions").append(p);e(p).fadeIn();setTimeout(function(){e("#bus_suggestions .correct").fadeOut(a);return setTimeout(function(){return e("#bus_suggestions").html("")},300)},1200);s(t,i)}}else e("#bus_suggestions .suggestion").fadeOut(a,function(){return e("#bus_suggestions").html("")});return n()}DEBUG&&console.log("keyup - enter, checking input");c=e(f).val();d=Bus.getStopIds(c);if(d.length!==0){h=Bus.getStopName(d[0]);e(f).val(h);e("#bus_suggestions").html("");p=e('<div class="correct">'+h+"</div>").hide();e("#bus_suggestions").append(p);e(p).fadeIn();setTimeout(function(){e("#bus_suggestions .correct").fadeOut(a);return setTimeout(function(){return e("#bus_suggestions").html("")},300)},1200);return s(t,h)}}});return e(i).change(function(){return c(t)})};s=function(t,n){var r,i,s,o,u;i="#"+t;u=e(i+" input");s=e(i+" select");r=Bus.getDirections(n);e(s).html("");for(o in r)e(s).append("<option>"+r[o]+"</option>");return c(t)};c=function(t){var n,i,s,o;i="#"+t;o=e(i+" input").val();s=e(i+" select").val();n=Bus.getStop(o,s);u[t]=n;u[t+"_name"]=o;u[t+"_direction"]=s;r();if(DEBUG)return console.log("saved http://api.visuweb.no/bybussen/1.0/Departure/Realtime/"+n+"/f6975f3c1a3d838dc69724b9445b3466")};o=function(t){var n,r,i;n="#"+t;i=u[t+"_name"];r=u[t+"_direction"];if(i!==void 0&&r!==void 0){e(n+" input").val(i);e(n+" select").val(r);if(DEBUG)return console.log("loaded "+i+" to "+t)}};n=function(){return e(".suggestion").click(function(){var t;if(u.busInFocus!==void 0){t=e(this).text();e("#"+u.busInFocus+" input").val(t);s(u.busInFocus,t);return e("#bus_suggestions .suggestion").fadeOut(50,function(){return e("#bus_suggestions").html("")})}})};p=function(t,n){var r,i;i=400;r="useInfoscreen";if(t){e("#"+r).attr("checked",!1);e("#logo_subtext").fadeOut();return e("#container #left").animate({width:"0pt"},i,function(){e("#container #left").hide();return e("#infoscreen_slider").slideUp(i,function(){return e("#infoscreen_preview").fadeIn(i,function(){e("#logo_subtext").html("infoscreen&nbsp;&nbsp;&nbsp;&nbsp;");return e("#logo_subtext").fadeIn(function(){e("header #logo_subtext").animate({"margin-left":"265pt"},i);e("header #logo").animate({"margin-left":"75pt"},i);e("#container #right").animate({"margin-left":"180pt"},i);e("header").animate({top:"40%"},i);return e("#container").animate({top:"40%"},i,function(){if(!n&&!confirm("Sikker på at du vil skru på Online Infoscreen?\n\n- Krever full-HD skjerm som står på høykant\n- Popup-knappen åpner Infoskjerm i stedet\n- Infoskjermen skjuler musepekeren\n- Infoskjermen åpnes hver gang Chrome starter\n- Infoskjermen åpnes nå!"))return l();u[r]="true";e("#"+r).attr("checked",!0);chrome.browserAction.setIcon({path:"img/icon-default.png"});chrome.browserAction.setTitle({title:"Online Infoscreen"});chrome.browserAction.setBadgeText({text:""});if(!n)return chrome.tabs.create({url:chrome.extension.getURL("infoscreen.html"),selected:!1})})})})})})}u[r]="false";d();return l()};l=function(){var t;t=300;return e("#logo_subtext").fadeOut(t,function(){e("#container").animate({top:"50%"},t);e("header").animate({top:"50%"},t);e("#container #right").animate({"margin-left":"0"},t);e("header #logo_subtext").animate({"margin-left":"215pt"},t);return e("header #logo").animate({"margin-left":"25pt"},t,function(){return e("#infoscreen_preview").fadeOut(t,function(){return e("#infoscreen_slider").slideDown(t,function(){e("#container #left").show();return e("#container #left").animate({width:"54%"},t,function(){e("#logo_subtext").html("notifier options");return e("#logo_subtext").fadeIn()})})})})})};i=function(){webGLStart();return e("#LessonCanvas").animate({opacity:1},1300,"swing",function(){return setTimeout(function(){return e("#LessonCanvas").animate({opacity:0},1300,"swing")},200)})};e(function(){DEBUG&&e("#debug_links").show();e("input:checkbox").each(function(e,t){if(u[t.id]==="true")return t.checked=!0});u.useInfoscreen==="true"&&setTimeout(function(){return p(!0,!0)},300);e(window).bind("resize",f);f();if(OPERATING_SYSTEM==="Windows"){e("#pagefliptext").attr("style","bottom:9px;");e("#pagefliplink").attr("style","bottom:9px;")}setInterval(function(){return a()},600);setTimeout(function(){return e("#plusonebutton").fadeIn(150)},1100);t("first_bus");t("second_bus");return e("input:checkbox").click(function(){if(this.id==="useInfoscreen")return p(this.checked);u[this.id]=this.checked;if(this.id==="showOffice"&&this.checked===!1){chrome.browserAction.setIcon({path:"img/icon-default.png"});chrome.browserAction.setTitle({title:EXTENSION_NAME})}else this.id==="showOffice"&&this.checked===!0&&d();this.id==="showNotifications"&&this.checked===!0&&h();return r()})})}).call(this);